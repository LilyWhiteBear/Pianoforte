<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pianoforte</title>
    <script src="js/pixi.min.js"></script>
    <script src="js/pixi-sound.js"></script>
    <script src="js/gameFunction/script.js"></script>
    <script src="js/gameFunction/ticker.js"></script>
    <script src="js/gameFunction/variables.js"></script>
    <script>

        window.onload = function () {
            app = new PIXI.Application(
                {
                    // width: appWidth,
                    // height: appHeight,
                    resizeTo: window,
                    backgroundColor: 0xffffff
                }
            );
            document.body.appendChild(app.view);

            background = new PIXI.Graphics();
            background.beginFill(0xAAAAAA);
            background.drawRect(appX, appY, appWidth, appHeight);
            app.stage.addChild(background);

            titleScreen = new PIXI.Container();
            tutorialScreen = new PIXI.Container();
            gachaScreen = new PIXI.Container();
            songSelectScreen = new PIXI.Container();
            playScreen = new PIXI.Container();
            resultScreen = new PIXI.Container();

            app.stage.addChild(titleScreen);
            app.stage.addChild(tutorialScreen);
            app.stage.addChild(gachaScreen);
            app.stage.addChild(songSelectScreen);
            app.stage.addChild(playScreen);
            app.stage.addChild(resultScreen);

            titleScreen.visible = true;
            tutorialScreen.visible = false;
            gachaScreen.visible = false;
            songSelectScreen.visible = false;
            playScreen.visible = false;
            resultScreen.visible = false;

            let ticker_fos = new PIXI.Ticker();
            ticker_fos.autoStart = true;
            ticker_fos.add(foschanLoop);

            let ticker = new PIXI.Ticker();
            ticker.autoStart = false;
            ticker.add(gameLoop);

            //title screen 
            let normalTicketText = new PIXI.Text("x" + tokenDict.normal_ticket);
            adjObj(normalTicketText, titleScreen, appX + appWidth * 0.9, appY + appHeight * 0.01, false);

            let normalTicketImage = new PIXI.Sprite.from("images/token/normal_ticket.png");
            adjSprite(normalTicketImage, titleScreen, appX + appWidth * 0.75, appY, appWidth * 0.1, appHeight * 0.05, false);

            let premiemTicketText = new PIXI.Text("x" + tokenDict.normal_ticket);
            adjObj(premiemTicketText, titleScreen, appX + appWidth * 0.9, appY + appHeight * 0.06, false);

            let premiemTicketImage = new PIXI.Sprite.from("images/token/premiem_ticket.png");
            adjSprite(premiemTicketImage, titleScreen, appX + appWidth * 0.75, appY + appHeight * 0.05, appWidth * 0.1, appHeight * 0.05, false);

            let titleText = new PIXI.Text("Pianoforte", Headerstyle);
            adjObj(titleText, titleScreen, appX + appWidth * 0.5, appY + appHeight * 0.15, false, 0.5);

            foschan1 = new PIXI.Sprite.from("images/char/foschan1.png");
            adjSprite(foschan1, titleScreen, appX + appWidth * 0.5, appY + appHeight * 0.45, appWidth * 0.6, appHeight * 0.5, false, 0.5);

            foschan2 = new PIXI.Sprite.from("images/char/foschan2.png");
            adjSprite(foschan2, titleScreen, appX + appWidth * 0.5, appY + appHeight * 0.45, appWidth * 0.6, appHeight * 0.5, false, 0.5);
            foschan2.visible = false;

            let startButton = new PIXI.Text("START", Headerstyle);
            adjObj(startButton, titleScreen, appX + appWidth * 0.5, appY + appHeight * 0.7, true, 0.5);
            startButton.on('pointerdown', function () {
                titleScreen.visible = false;
                songSelectScreen.visible = true;
            });

            let tutorialButton = new PIXI.Text("TUTORIAL", Menustyle2);
            adjObj(tutorialButton, titleScreen, appX + appWidth * 0.5, appY + appHeight * 0.8, true, 0.5);
            tutorialButton.on('pointerdown', function () {
                interactiveSwitch(titleScreen, false);
                tutorialScreen.visible = true;
            });

            let gachaButton = new PIXI.Sprite.from("images/button/gacha.png");
            adjSprite(gachaButton, titleScreen, appX + appWidth * 0.35, appY + appHeight * 0.9, appWidth * 0.15, appWidth * 0.15, true, 0.5);
            gachaButton.on('pointerdown', function () {
                titleScreen.visible = false;
                gachaScreen.visible = true;
            });
            titleScreen.addChild(gachaButton);

            //tutorial screen


            //gacha screen
            let boss_coinText = new PIXI.Text("x" + tokenDict.boss_coin);
            adjObj(boss_coinText, gachaScreen, appX + appWidth * 0.75, appY + appHeight * 0.01, false);

            let boss_coinImage = new PIXI.Sprite.from("images/token/boss_coin.png");
            adjSprite(boss_coinImage, gachaScreen, appX + appWidth * 0.6, appY, appWidth * 0.1, appHeight * 0.05, false);

            let chonlasit_coinText = new PIXI.Text("x" + tokenDict.chonlasit_coin);
            adjObj(chonlasit_coinText, gachaScreen, appX + appWidth * 0.75, appY + appHeight * 0.06, false);

            let chonlasit_coinImage = new PIXI.Sprite.from("images/token/chonlasit_coin.png");
            adjSprite(chonlasit_coinImage, gachaScreen, appX + appWidth * 0.6, appY + appHeight * 0.05, appWidth * 0.1, appHeight * 0.05, false);

            let esc_text = new PIXI.Text("BACK", Menustyle);
            adjObj(esc_text, gachaScreen, appX, appY, true);
            esc_text.on('pointerdown', function () {
                titleScreen.visible = true;
                gachaScreen.visible = false;
            });

            let gachaPlayx1 = new PIXI.Sprite.from("/images/button/gachaPlay1.png");
            adjSprite(gachaPlayx1, gachaScreen, appX + appWidth * 0.25, appY + appHeight * 0.8, appWidth * 0.45, appWidth * 0.15, true, 0.5);

            let gachaPlayx10 = new PIXI.Sprite.from("/images/button/gachaPlay10.png");
            adjSprite(gachaPlayx10, gachaScreen, appX + appWidth * 0.75, appY + appHeight * 0.8, appWidth * 0.45, appWidth * 0.15, true, 0.5);

            //song select screen
            let backButton = new PIXI.Text("BACK", Menustyle);
            adjObj(backButton, songSelectScreen, appX, appY, true);
            backButton.on('pointerdown', function () {
                songSelectScreen.visible = false;
                titleScreen.visible = true;
            });

            let songSelectText = new PIXI.Text("Select song", Headerstyle);
            adjObj(songSelectText, songSelectScreen, appX + appWidth * 0.02, appY + appHeight * 0.07, false);

            let settingButton = new PIXI.Sprite.from("images/button/setting_button.png");
            adjSprite(settingButton, songSelectScreen, appX + appWidth * 0.85, appY, appWidth * 0.15, appWidth * 0.15, true);
            settingButton.on('pointerdown', function () {
                songSelectScreen.visible = false;

                let settingContainer = new PIXI.Container();
                app.stage.addChild(settingContainer);
                settingContainer.visible = true;

                let settingText = new PIXI.Text("Setting", Headerstyle);
                adjObj(settingText, settingContainer, appX + appWidth * 0.05, appY + appHeight * 0.025, false);

                let settingClose = new PIXI.Text("X", Headerstyle);
                adjObj(settingClose, settingContainer, appX + appWidth * 0.85, appY + appHeight * 0.025, true);
                settingClose.on('pointerdown', function () {
                    settingContainer.visible = false;
                    songSelectScreen.visible = true;
                });

                let volumnText = new PIXI.Text("Volumn");
                adjObj(volumnText, settingContainer, appX + appWidth * 0.05, appY + appHeight * 0.15, false);

                let volumnDecrease = new PIXI.Text("-");
                adjObj(volumnDecrease, settingContainer, appX + appWidth * 0.6, appY + appHeight * 0.15, true);
                volumnDecrease.on('pointerdown', function () {
                    if (volumn >= 5) {
                        volumn -= 5;
                        volumnModify.text = volumn;
                        let testSound = new PIXI.sound.Sound.from({
                            url: 'sounds/poi.mp3',
                            autoPlay: true,
                            volume: volumn / 100,
                        });
                    }
                });

                let volumnIncrease = new PIXI.Text("+");
                adjObj(volumnIncrease, settingContainer, appX + appWidth * 0.8, appY + appHeight * 0.15, true);
                volumnIncrease.on('pointerdown', function () {
                    if (volumn <= 95) {
                        volumn += 5;
                        volumnModify.text = volumn;
                        let testSound = new PIXI.sound.Sound.from({
                            url: 'sounds/poi.mp3',
                            autoPlay: true,
                            volume: volumn / 100,
                        });
                    }
                });

                let volumnModify = new PIXI.Text(volumn);
                adjObj(volumnModify, settingContainer, appX + appWidth * 0.72, appY + appHeight * 0.17, false, 0.5);

                let speedText = new PIXI.Text("NoteSpeed");
                adjObj(speedText, settingContainer, appX + appWidth * 0.05, appY + appHeight * 0.25, false);

                let speedDecrease = new PIXI.Text("-");
                adjObj(speedDecrease, settingContainer, appX + appWidth * 0.6, appY + appHeight * 0.25, true);
                speedDecrease.on('pointerdown', function () {
                    if (speed > 4) {
                        speed--;
                        speedModify.text = speed;
                        rankTextModify();
                    }
                });

                let speedIncrease = new PIXI.Text("+");
                adjObj(speedIncrease, settingContainer, appX + appWidth * 0.8, appY + appHeight * 0.25, true);
                speedIncrease.on('pointerdown', function () {
                    if (speed < 20) {
                        speed++;
                        speedModify.text = speed;
                        rankTextModify();
                    }
                });

                let speedModify = new PIXI.Text(speed);
                adjObj(speedModify, settingContainer, appX + appWidth * 0.72, appY + appHeight * 0.27, false, 0.5);

                let rankDesc = new PIXI.Text("Difficulty");
                adjObj(rankDesc, settingContainer, appX + appWidth * 0.05, appY + appHeight * 0.35, false);

                let rankText = new PIXI.Text("");
                rankText.style.fontWeight = "bold";
                adjObj(rankText, settingContainer, appX + appWidth * 0.72, appY + appHeight * 0.37, false, 0.5);
                rankTextModify();

                function rankTextModify() {
                    if (speed >= 15) {
                        rankText.style.fill = 0xda0000;
                        rankText.text = "MASTER"
                    }
                    else if (speed >= 12) {
                        rankText.style.fill = 0xFF5733;
                        rankText.text = "HARD"
                    }
                    else if (speed >= 8) {
                        rankText.style.fill = 0xFFC300;
                        rankText.text = "NORMAL"
                    }
                    else {
                        rankText.style.fill = 0x006d33;
                        rankText.text = "EASY"
                    }
                }

            });

            let songContainer = new PIXI.Container();
            songSelectScreen.addChild(songContainer);

            for (let i in songDict) {
                let songButton = new PIXI.Container();
                songSelectScreen.addChild(songButton);

                let songButtonBG = new PIXI.Graphics();
                if (i % 2 === 0) songButtonBG.beginFill(0xeaeaea);
                else songButtonBG.beginFill(0xc6e2ff);
                songButtonBG.drawRect(appX, appY + appHeight * 0.15 + (i * 0.05 * appHeight), appWidth, appHeight * 0.05);
                songButton.addChild(songButtonBG);

                let songName = new PIXI.Text(songDict[i].name);
                adjObj(songName, songButton, appX + appWidth * 0.4, appY + appHeight * 0.175 + (i * 0.05 * appHeight), false, 0.5);

                let songTime = new PIXI.Text(songDict[i].time);
                adjObj(songTime, songButton, appX + appWidth * 0.9, appY + appHeight * 0.175 + (i * 0.05 * appHeight), false, 0.5);

                songButton.interactive = true;
                songButton.buttonMode = true;
                songButton.on('pointerdown', function () {

                    interactiveSwitch(songSelectScreen, false);

                    let confirmSpeedScreen = new PIXI.Container();
                    songSelectScreen.addChild(confirmSpeedScreen);

                    let csBG = new PIXI.Graphics();
                    csBG.beginFill(0xffffff);
                    csBG.drawRect(appX + appWidth * 0.1, appY + appHeight * 0.3, appWidth * 0.8, appHeight * 0.4);
                    confirmSpeedScreen.addChild(csBG);

                    let csClose = new PIXI.Text("X", Headerstyle);
                    adjObj(csClose, confirmSpeedScreen, appX + appWidth * 0.8, appY + appHeight * 0.3, true);
                    csClose.on('pointerdown', function () {
                        songSelectScreen.removeChild(confirmSpeedScreen);
                        interactiveSwitch(songSelectScreen, true);
                    });

                    let speedTextConfirm = new PIXI.Text("NoteSpeed");
                    adjObj(speedTextConfirm, confirmSpeedScreen, appX + appWidth * 0.15, appY + appHeight * 0.45, false);

                    let speedDecreaseConfirm = new PIXI.Text("-");
                    adjObj(speedDecreaseConfirm, confirmSpeedScreen, appX + appWidth * 0.6, appY + appHeight * 0.45, true);
                    speedDecreaseConfirm.on('pointerdown', function () {
                        if (speed > 4) {
                            speed--;
                            speedModifyConfirm.text = speed;
                            rankTextModify();
                        }
                    });

                    let speedIncreaseConfirm = new PIXI.Text("+");
                    adjObj(speedIncreaseConfirm, confirmSpeedScreen, appX + appWidth * 0.8, appY + appHeight * 0.45, true);
                    speedIncreaseConfirm.on('pointerdown', function () {
                        if (speed < 20) {
                            speed++;
                            speedModifyConfirm.text = speed;
                            rankTextModify();
                        }
                    });

                    let speedModifyConfirm = new PIXI.Text(speed);
                    adjObj(speedModifyConfirm, confirmSpeedScreen, appX + appWidth * 0.72, appY + appHeight * 0.47, true, 0.5);

                    let playButtonNormal = new PIXI.Sprite.from("/images/button/button.png");
                    adjObj(playButtonNormal, confirmSpeedScreen, appX + appWidth * 0.3, appY + appHeight * 0.6, true, 0.5);
                    if (tokenDict.normal_ticket <= 0) playButtonNormal.interactive = false;
                    playButtonNormal.on('pointerdown', function () { gameStart(1); });

                    let playButtonPremiem = new PIXI.Sprite.from("/images/button/button.png");
                    adjObj(playButtonPremiem, confirmSpeedScreen, appX + appWidth * 0.7, appY + appHeight * 0.6, true, 0.5);
                    if (tokenDict.premiem_ticket <= 0) playButtonPremiem.interactive = false;
                    playButtonPremiem.on('pointerdown', function () { gameStart(5); });

                    function gameStart(modifier) {
                        if (modifier === 1 && tokenDict.normal_ticket > 0) {
                            tokenDict.normal_ticket -= 1;
                            normalTicketText.text = "x" + tokenDict.normal_ticket;
                        }
                        else if (modifier === 5 && tokenDict.premiem_ticket > 0) {
                            tokenDict.premiem_ticket -= 1;
                            premiemTicketText.text = "x" + tokenDict.premiem_ticket;
                        }
                        else {
                            console.log('error');
                            return;
                        }

                        interactiveSwitch(songSelectScreen, true);

                        songSelectScreen.removeChild(confirmSpeedScreen);
                        songSelectScreen.visible = false;
                        playScreen.visible = true;
                        scoreText.text = "0";
                        comboText.text = "0 combos";
                        playing_accuracyText.text = "0%"
                        startTime = new Date().getTime();
                        timeDistance = songDict[i] * 1000;
                        accuracy_score = 0;
                        score = 0;
                        combo = 0;
                        maxCombo = 0;
                        ticker_count = 0;
                        note_num = 0;
                        perfectTap = 0;
                        goodTap = 0;
                        badTap = 0;
                        missTap = 0;
                        performancePlay = [];
                        while (candleArray.length > 0) {
                            resultScreen.removeChild(candleArray[0]);
                            candleArray.shift();
                        }
                        ticker.start();
                        //song
                        song = new PIXI.sound.Sound.from({
                            url: songDict[i].path,
                            autoPlay: true,
                            volume: volumn / 10,
                            complete: function () {
                                isEnd = true;
                                setTimeout(function () {
                                    if (combo === note_num) perfectText.visible = true;
                                    ticker.stop();
                                }, 5000);
                                setTimeout(function () {
                                    isEnd = false;
                                    songText.text = songDict[i].name;

                                    if (accuracy === 100) gradeText.text = "SSS";
                                    else if (accuracy >= 95) gradeText.text = "SS";
                                    else if (accuracy >= 90) gradeText.text = "S";
                                    else if (accuracy >= 85) gradeText.text = "A";
                                    else if (accuracy >= 80) gradeText.text = "B";
                                    else if (accuracy >= 70) gradeText.text = "C";
                                    else if (accuracy >= 50) gradeText.text = "D";
                                    else gradeText.text = "F";
                                    accuracyText.text = "accuracy " + accuracy + "%";
                                    maxComboText.text = "Max Combo : " + maxCombo + "combo";
                                    resultScoreText.text = "score : " + score;
                                    perfectTapText.text = perfectTap + " perfect";
                                    goodTapText.text = goodTap + " good";
                                    badTapText.text = badTap + " bad";
                                    missTapText.text = missTap + " miss";
                                    perfectText.visible = false;
                                    playScreen.visible = false;
                                    resultScreen.visible = true;
                                    let graphX = perfromanceGraphProp.x;
                                    let graphY = perfromanceGraphProp.y;
                                    let graphWidth = perfromanceGraphProp.width;
                                    let graphHeight = perfromanceGraphProp.height;
                                    for (let i in performancePlay) {
                                        let candle = new PIXI.Graphics();
                                        if (i != 0 && performancePlay[i] < performancePlay[i - 1])
                                            candle.beginFill(0xDC143C);
                                        else candle.beginFill(0x1ca700);
                                        let drawX = graphX + (((i + 1) / note_num) / 10 * graphWidth);
                                        let drawY = graphY + ((3 - performancePlay[i]) / 4) * graphHeight;
                                        candle.drawRect(drawX, drawY, graphWidth / note_num, graphHeight / 4);
                                        resultScreen.addChild(candle);
                                        candleArray.push(candle);
                                    }
                                }, 8000);
                            }
                        }
                        )
                    }
                });
            }


            //play screen
            pauseButton = new PIXI.Sprite.from("images/button/pause.png");
            adjSprite(pauseButton, playScreen, appX, appY, appWidth * 0.08, appWidth * 0.08, true);
            pauseButton.on('pointerdown', function () {
                interactiveSwitch(playScreen, false);
                song.pause();
                ticker.stop();

                //pause screen
                let pauseScreen = new PIXI.Container();
                playScreen.addChild(pauseScreen);

                let pauseBorder = new PIXI.Graphics();
                pauseBorder.beginFill(0x000000);
                pauseBorder.drawRect(appX + appWidth * 0.195, appY + appHeight * 0.345, appWidth * 0.61, appHeight * 0.26);
                pauseScreen.addChild(pauseBorder);

                let pauseBG = new PIXI.Graphics();
                pauseBG.beginFill(0x74CCF4);
                pauseBG.drawRect(appX + appWidth * 0.2, appY + appHeight * 0.35, appWidth * 0.6, appHeight * 0.25);
                pauseScreen.addChild(pauseBG);

                let pauseText = new PIXI.Text("PAUSE", Menustyle2);
                adjObj(pauseText, pauseScreen, appX + appWidth * 0.5, appY + appHeight * 0.4, false, 0.5);
                pauseScreen.addChild(pauseText);

                let resumeBorder = new PIXI.Graphics();
                resumeBorder.beginFill(0x000000);
                resumeBorder.drawRect(appX + appWidth * 0.255, appY + appHeight * 0.475, appWidth * 0.23, appHeight * 0.07);
                pauseScreen.addChild(resumeBorder);

                let resumeButton = new PIXI.Graphics();
                resumeButton.beginFill(0xffffff);
                resumeButton.drawRect(appX + appWidth * 0.26, appY + appHeight * 0.48, appWidth * 0.22, appHeight * 0.06);
                resumeButton.interactive = true;
                resumeButton.buttonMode = true;
                resumeButton.on('pointerdown', function () {
                    interactiveSwitch(playScreen, true);
                    song.resume();
                    ticker.start();
                    playScreen.removeChild(pauseScreen);
                });
                pauseScreen.addChild(resumeButton);

                let resumeText = new PIXI.Text("resume");
                adjObj(resumeText, resumeButton, appX + appWidth * 0.37, appY + appHeight * 0.5, false, 0.5);

                let exitBorder = new PIXI.Graphics();
                exitBorder.beginFill(0x000000);
                exitBorder.drawRect(appX + appWidth * 0.515, appY + appHeight * 0.475, appWidth * 0.23, appHeight * 0.07);
                pauseScreen.addChild(exitBorder);

                let exitButton = new PIXI.Graphics();
                exitButton.beginFill(0xffffff);
                exitButton.drawRect(appX + appWidth * 0.52, appY + appHeight * 0.48, appWidth * 0.22, appHeight * 0.06);
                exitButton.interactive = true;
                exitButton.buttonMode = true;
                exitButton.on('pointerdown', function () {
                    interactiveSwitch(pauseScreen, false);

                    //confirmExit screen
                    let confirmExitScreen = new PIXI.Container();
                    pauseScreen.addChild(confirmExitScreen);

                    let confirmExitBorder = new PIXI.Graphics();
                    confirmExitBorder.beginFill(0x000000);
                    confirmExitBorder.drawRect(appX + appWidth * 0.2, appY + appHeight * 0.375, appWidth * 0.6, appHeight * 0.2);
                    confirmExitScreen.addChild(confirmExitBorder);

                    let confirmExitBG = new PIXI.Graphics();
                    confirmExitBG.beginFill(0x74CCF4);
                    confirmExitBG.drawRect(appX + appWidth * 0.205, appY + appHeight * 0.38, appWidth * 0.59, appHeight * 0.19);
                    confirmExitScreen.addChild(confirmExitBG);

                    let confirmExitText = new PIXI.Text("Will you exit?", Menustyle2);
                    adjObj(confirmExitText, confirmExitScreen, appX + appWidth * 0.5, appY + appHeight * 0.45, false, 0.5);
                    confirmExitScreen.addChild(confirmExitText);

                    let yesText = new PIXI.Text("yes", Dangerstyle);
                    adjObj(yesText, confirmExitScreen, appX + appWidth * 0.4, appY + appHeight * 0.5, true, 0.5);
                    yesText.on('pointerdown', function() {
                        interactiveSwitch(playScreen, true);
                        clearPlayScreen();
                        playScreen.removeChild(pauseScreen);
                        playScreen.visible = false;
                        titleScreen.visible = true;
                    });

                    let noText = new PIXI.Text("no", Menustyle2);
                    adjObj(noText, confirmExitScreen, appX + appWidth * 0.6, appY + appHeight * 0.5, true, 0.5);
                    noText.on('pointerdown', function() {
                        interactiveSwitch(pauseScreen, true);
                        pauseScreen.removeChild(confirmExitScreen);
                    });
                });
                pauseScreen.addChild(exitButton);

                let exitText = new PIXI.Text("exit");
                adjObj(exitText, exitButton, appX + appWidth * 0.62, appY + appHeight * 0.5, false, 0.5);

            });

            textureSButton = PIXI.Texture.from("images/button/S.png");
            textureDButton = PIXI.Texture.from("images/button/D.png");
            textureKButton = PIXI.Texture.from("images/button/K.png");
            textureLButton = PIXI.Texture.from("images/button/L.png");

            texture_pressedSButton = PIXI.Texture.from("images/button/S_pressed.png");
            texture_pressedDButton = PIXI.Texture.from("images/button/D_pressed.png");
            texture_pressedKButton = PIXI.Texture.from("images/button/K_pressed.png");
            texture_pressedLButton = PIXI.Texture.from("images/button/L_pressed.png");

            SButton = new PIXI.Sprite(textureSButton);
            adjSprite(SButton, playScreen, appX + appWidth * 0.125, appY + appHeight * 0.925, appWidth * 0.25, appHeight * 0.15, true, 0.5);
            SButton.on('pointerdown', function () {
                keys['83'] = true;
            });
            SButton.on('pointerup', function () {
                keys['83'] = false;
            });
            SButton.on('pointerout', function () {
                keys['83'] = false;
            });

            DButton = new PIXI.Sprite(textureDButton);
            adjSprite(DButton, playScreen, appX + appWidth * 0.375, appY + appHeight * 0.925, appWidth * 0.25, appHeight * 0.15, true, 0.5);
            DButton.on('pointerdown', function () {
                keys['68'] = true;
            });
            DButton.on('pointerup', function () {
                keys['68'] = false;
            });
            DButton.on('pointerout', function () {
                keys['68'] = false;
            });

            KButton = new PIXI.Sprite(textureKButton);
            adjSprite(KButton, playScreen, appX + appWidth * 0.625, appY + appHeight * 0.925, appWidth * 0.25, appHeight * 0.15, true, 0.5);
            KButton.on('pointerdown', function () {
                keys['75'] = true;
            });
            KButton.on('pointerup', function () {
                keys['75'] = false;
            });
            KButton.on('pointerout', function () {
                keys['75'] = false;
            });

            LButton = new PIXI.Sprite(textureLButton);
            adjSprite(LButton, playScreen, appX + appWidth * 0.875, appY + appHeight * 0.925, appWidth * 0.25, appHeight * 0.15, true, 0.5);
            LButton.on('pointerdown', function () {
                keys['76'] = true;
            });
            LButton.on('pointerup', function () {
                keys['76'] = false;
            });
            LButton.on('pointerout', function () {
                keys['76'] = false;
            });

            scoreText = new PIXI.Text("0");
            adjObj(scoreText, playScreen, appX + appWidth * 0.5, appY + appHeight * 0.2, false, 0.5);

            comboText = new PIXI.Text("0 combos");
            adjObj(comboText, playScreen, appX + appWidth * 0.5, appY + appHeight * 0.25, false, 0.5);

            playing_accuracyText = new PIXI.Text("0%");
            adjObj(playing_accuracyText, playScreen, appX + appWidth * 0.75, appY + appHeight * 0.05, false);

            hitTextS = new PIXI.Text();
            adjObj(hitTextS, playScreen, appX + appWidth * 0.125, appY + appHeight * 0.55, false, 0.5);

            hitTextD = new PIXI.Text();
            adjObj(hitTextD, playScreen, appX + appWidth * 0.375, appY + appHeight * 0.55, false, 0.5);

            hitTextK = new PIXI.Text();
            adjObj(hitTextK, playScreen, appX + appWidth * 0.625, appY + appHeight * 0.55, false, 0.5);

            hitTextL = new PIXI.Text();
            adjObj(hitTextL, playScreen, appX + appWidth * 0.875, appY + appHeight * 0.55, false, 0.5);

            perfectText = new PIXI.Text("PERFECT COMBO!!!");
            adjObj(perfectText, playScreen, appX + appWidth * 0.5, appY + appHeight * 0.3, false, 0.5);
            perfectText.style.fontSize = 30;

            hitTextS.visible = false;
            hitTextD.visible = false;
            hitTextK.visible = false;
            hitTextL.visible = false;
            perfectText.visible = false;

            //result screen
            let songText = new PIXI.Text("untiltled");
            songText.fontWeight = "bold";
            adjObj(songText, resultScreen, appX + appWidth * 0.1, appY + appHeight * 0.05, false);

            let accuracyText = new PIXI.Text("accuracy 0%");
            adjObj(accuracyText, resultScreen, appX + appWidth * 0.1, appY + appHeight * 0.1, false);

            let gradeTextStyle = new PIXI.TextStyle({
                fill: rainbowGradient,
                fillGradientType: 1,
                fontFamily: "Comic Sans MS",
                fontSize: 50,
                fontWeight: "bold"
            });

            let gradeText = new PIXI.Text("F", gradeTextStyle);
            adjObj(gradeText, resultScreen, appX + appWidth * 0.8, appY + appHeight * 0.1, false, 0.5);

            let maxComboText = new PIXI.Text("0 combos");
            adjObj(maxComboText, resultScreen, appX + appWidth * 0.5, appY + appHeight * 0.25, false, 0.5);

            let resultScoreText = new PIXI.Text(score);
            adjObj(resultScoreText, resultScreen, appX + appWidth * 0.5, appY + appHeight * 0.2, false, 0.5);

            let perfectTapText = new PIXI.Text("perfect");
            adjObj(perfectTapText, resultScreen, appX + appWidth * 0.1, appY + appHeight * 0.3, false);

            let goodTapText = new PIXI.Text("good");
            adjObj(goodTapText, resultScreen, appX + appWidth * 0.6, appY + appHeight * 0.3, false);

            let badTapText = new PIXI.Text("bad");
            adjObj(badTapText, resultScreen, appX + appWidth * 0.1, appY + appHeight * 0.35, false);

            let missTapText = new PIXI.Text("miss");
            adjObj(missTapText, resultScreen, appX + appWidth * 0.6, appY + appHeight * 0.35, false);

            let performanceText = new PIXI.Text("Performance Graph");
            adjObj(performanceText, resultScreen, appX + appWidth * 0.1, perfromanceGraphProp.y - (appHeight * 0.1), false);

            performanceGraph = new PIXI.Graphics();
            performanceGraph.beginFill(0xFFFFFF);
            performanceGraph.drawRect(perfromanceGraphProp.x, perfromanceGraphProp.y, perfromanceGraphProp.width, perfromanceGraphProp.height);
            resultScreen.addChild(performanceGraph);

            let perfectPText = new PIXI.Text("PERFECT");
            adjObj(perfectPText, resultScreen, appX + appWidth * 0.1, perfromanceGraphProp.y + (perfromanceGraphProp.height / 5), false, 0.5);
            perfectPText.style.fontSize = 8;

            let goodText = new PIXI.Text("GOOD");
            adjObj(goodText, resultScreen, appX + appWidth * 0.1, perfromanceGraphProp.y + (perfromanceGraphProp.height * 2 / 5), false, 0.5);
            goodText.style.fontSize = 8;

            let badText = new PIXI.Text("BAD");
            adjObj(badText, resultScreen, appX + appWidth * 0.1, perfromanceGraphProp.y + (perfromanceGraphProp.height * 3 / 5), false, 0.5);
            badText.style.fontSize = 8;

            let missText = new PIXI.Text("MISS");
            adjObj(missText, resultScreen, appX + appWidth * 0.1, perfromanceGraphProp.y + (perfromanceGraphProp.height * 4 / 5), false, 0.5);
            missText.style.fontSize = 8;

            let restartButton = new PIXI.Sprite.from("images/button/button.png");
            adjSprite(restartButton, resultScreen, appX + appWidth * 0.5, appY + appHeight * 0.9, appWidth * 0.3, appHeight * 0.1, true, 0.5);
            restartButton.on('pointerdown', function () {
                resultScreen.visible = false;
                titleScreen.visible = true;
                if (tokenDict.normal_ticket <= 0 && tokenDict.premiem_ticket <= 0) startButton.interactive = false;
            });

            //invisible layer
            top_layer = new PIXI.Graphics();
            top_layer.beginFill(0xffffff);
            top_layer.drawRect(0, 0, windowWidth, appY);
            playScreen.addChild(top_layer);

            ground_layer = new PIXI.Graphics();
            ground_layer.beginFill(0xffffff);
            ground_layer.drawRect(0, appY + appHeight, windowWidth, windowHeight - appY - appHeight);
            playScreen.addChild(ground_layer);


            for (let i = 1; i <= 3; i++) {
                let seperater = new PIXI.Graphics();
                seperater.beginFill(0xC70039);
                seperater.drawRect(appX + appWidth * 0.25 * i, appY, 1, appHeight);
                playScreen.addChild(seperater);
            }

            //keyboard event handler
            window.addEventListener("keydown", keysDown);
            window.addEventListener("keyup", keysUp);

        }
    </script>
</head>